import{_ as W}from"./LoadingAndError.71246b88.js";import{_ as X}from"./PageBaseLayout.c72097e2.js";import{_ as L,r as p,h as U,u as Y,j as Z,o,k as b,a as t,w as e,s as j,b as h,V as u,F as $,n as ee,A as H,c,d,t as v,f,e as _,m as n,l as T,v as le,bH as te}from"./entry.26e0f55e.js";import{u as ae}from"./useToEnglishDigits.dc917fe9.js";import{u as re}from"./useMyFetch.c7da1f4b.js";import{V as oe,h as P}from"./VFileInput.03cfb6c6.js";import{u as se}from"./supportMsg.c5092646.js";import{n as ne}from"./nurse.fff779d4.js";import{V as R}from"./VDialog.f2547840.js";import{V as A,b as E}from"./VCard.5845edb6.js";import{V as I}from"./VImg.e043ba4f.js";import{V as ce}from"./VAvatar.c6243a7c.js";import{V as ie}from"./VTextField.dc9b27e5.js";import{V as de}from"./VApp.dbfd8bb3.js";import"./VAlert.ba30a257.js";import"./createSimpleFunctional.17b0ee17.js";import"./VForm.82fb9e0d.js";import"./forwardRefs.e2994a01.js";import"./auth.d560fba5.js";import"./cookie.8aa2c3a6.js";import"./_commonjsHelpers.23102255.js";import"./VField.de963f4c.js";import"./index.4548580c.js";import"./index.7aba734a.js";import"./VInput.46c0eb00.js";import"./easing.9f15041e.js";import"./VChip.342a6faf.js";import"./VOverlay.1a61fd31.js";import"./lazy.54b8b11e.js";import"./dialog-transition.de049125.js";const ue={setup(){const w=p(!1),g=p(!1),F=se(),a=U(()=>F.getAllMessages),D=Y(),z=p(!1),k=p(""),S=p(""),l=r=>{const s=r.getHours(),M=String(r.getMinutes()).padStart(2,"0");return`${String(s).padStart(2,"0")}:${String(M).padStart(2,"0")}`},V=U(()=>l(new Date)),m=r=>{const s=r.toLocaleDateString("fa-IR");return ae(s)},i=p([]),C=p(!1),y=p(null),N=U(()=>[r=>{var s;return((s=r[0])==null?void 0:s.size)>1e6?(C.value=!0,!1):(C.value=!1,!0)}]),K=async()=>{if(i.value.length>0&&!C.value){const r=new FileReader;if(r.onload=s=>{S.value=r.result},i.value[0].type==="image/heic")try{const s=await P({blob:i.value[0]});r.readAsDataURL(s)}catch(s){console.error("Error converting image:",s)}else r.readAsDataURL(i.value[0])}};Z(i,r=>{r&&K()});const G=async()=>{const r=new FormData;let s={};if(y.value)s={Content:y.value,IsUserSend:!0,time:V.value,date:m(new Date),loading:p(!0),error:p(!1),Seen:!1,MessageType:"text"},a.value.push(s),r.append("Content",y.value),r.append("MessageType","text"),r.append("File",""),y.value=null,window.scrollTo({top:1e3,behavior:"smooth"});else if(i.value.length>0&&!C.value){if(y.value=null,s={Content:y.value,image:S.value,IsUserSend:!0,time:V.value,date:m(new Date),loading:p(!0),error:p(!1),Seen:!1,MessageType:"image"},a.value.push(s),r.append("Content",null),r.append("MessageType","image"),i.value[0].type==="image/heic"){const x=await P({blob:i.value[0]}),Q=i.value[0].name.replace("HEIC","jpeg");var M=new File([x],Q,{type:"image/jpeg"});r.append("File",M)}else console.log(i.value[0]),r.append("File",i.value[0]);i.value=[],window.scrollTo({top:1e3,behavior:"smooth"})}else return;try{const x=await re("/Message/send",s.loading,s.error,"post","",r);console.log(x)}catch(x){x=!0,console.error("Error fetching data:",x)}},q=()=>{i.value=[]},J=r=>{z.value=!0,k.value=r},B=()=>{F.getSupportMessages(w,g)},O=()=>{g.value=!1,w.value=!1,B()};return B(),{chat:a,msg:y,send:G,loading:w,error:g,getTime:V,rules:N,chatImg:i,imgSrc:S,imgInvalid:C,closePreview:q,imgFullSize:z,imgFullSizePreview:J,fullSizePreviewImg:k,nurseServices:ne,reloadHandler:O,routBackHandler:()=>{D.push("/support")}}}},ge={class:"grey-lighten-4 text-right text"},me={class:"text-grey-darken-1 text-subtitle"},pe={class:"text-grey-darken-1 text-subtitle"},fe={key:1,class:"bg-teal-lighten-5 ml-2 rounded-lg pa-2 text msg-width"},_e={class:"text-grey-darken-1 text-subtitle"},he={class:"text-grey-darken-1 text-subtitle"},ve={key:0,class:"text-center text-error"},ye={class:"d-flex align-center justify-center fill-height"};function xe(w,g,F,a,D,z){const k=W,S=X;return o(),b("div",null,[t(de,null,{default:e(()=>[t(S,{title:"چت با پشتیبانی",subPagesMode:!0,messenger:!0,onBaseRouteBackHandler:a.routBackHandler},{default:e(()=>[t(j,{class:"chat-box pa-2 mx-auto"},{default:e(()=>[t(h,{"no-gutters":""},{default:e(()=>[t(u,{lg:"6",xl:"6",md:"8",cols:"12",class:"mx-auto"},{default:e(()=>[t(h,{"no-gutters":"",class:"mb-10"},{default:e(()=>[t(u,{class:"pa-2",cols:"12"},{default:e(()=>[(o(!0),b($,null,ee(a.chat,(l,V)=>(o(),b("div",{key:V,class:H(["d-flex flex-row  my-3 align-center",l.IsUserSend?"justify-end":null])},[l.IsUserSend?(o(),b("div",{key:0,class:H([" mr-2 rounded-lg pa-2 msg-width",l.MessageType==="text"?"bg-amber-lighten-4":""])},[l.MessageType==="text"?(o(),c(h,{key:0},{default:e(()=>[t(u,{cols:"12 ",class:"pa-0 px-3 pt-2"},{default:e(()=>[d("p",ge,v(l.Content),1)]),_:2},1024),t(u,{cols:"12",class:"px-3 pb-2 pa-0 d-flex justify-space-between align-center text"},{default:e(()=>[d("div",null,[l.loading?(o(),c(f,{key:0,color:"grey-darken-1"},{default:e(()=>[_("mdi-check")]),_:1})):n("",!0),l.error?(o(),c(f,{key:1,color:"red"},{default:e(()=>[_("mdi-alert-circle")]),_:1})):n("",!0),!l.loading&&!l.error?(o(),c(f,{key:2,color:l.Seen?"blue-accent-3":"grey-darken-1"},{default:e(()=>[_("mdi-check-all")]),_:2},1032,["color"])):n("",!0)]),d("div",null,[d("p",me,v(l.date)+" "+v(l.time),1)])]),_:2},1024)]),_:2},1024)):n("",!0),l.MessageType==="image"?(o(),c(h,{key:1},{default:e(()=>[t(h,{justify:"center"},{default:e(()=>[t(R,{width:"500",modelValue:a.imgFullSize,"onUpdate:modelValue":g[0]||(g[0]=m=>a.imgFullSize=m),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:e(({isActive:m})=>[t(A,null,{default:e(()=>[t(E,{style:{"background-color":"black",height:"100vh"}},{default:e(()=>[t(I,{src:a.fullSizePreviewImg,width:"auto",cover:"",class:"rounded-lg"},null,8,["src"]),t(T,{icon:"mdi-close",position:"absolute",style:{top:"10px"},color:"white",size:"x-large",onClick:i=>m.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),d("div",null,[t(I,{src:l.image,"max-width":400,width:200,onClick:m=>a.imgFullSizePreview(l.image),cover:"",class:"rounded-t-lg"},null,8,["src","onClick"]),t(u,{cols:"12",class:"px-3 pa-0 d-flex justify-space-between align-center align-self-end text-subtitle bg-amber-lighten-4 rounded-b-lg"},{default:e(()=>[d("div",null,[l.loading?(o(),c(f,{key:0,color:"grey-darken-1"},{default:e(()=>[_("mdi-check")]),_:1})):n("",!0),l.error?(o(),c(f,{key:1,color:"red"},{default:e(()=>[_("mdi-alert-circle")]),_:1})):n("",!0),!l.loading&&!l.error?(o(),c(f,{key:2,color:l.Seen?"blue-accent-3":"grey-darken-1"},{default:e(()=>[_("mdi-check-all")]),_:2},1032,["color"])):n("",!0)]),d("div",null,[d("p",pe,v(l.date)+" "+v(l.time),1)])]),_:2},1024)])]),_:2},1024)):n("",!0)],2)):n("",!0),t(ce,{color:l.IsUserSend?"amber-darken-4":"teal-accent-4",size:"36"},{default:e(()=>[l.IsUserSend?(o(),c(f,{key:0,class:"white--text"},{default:e(()=>[_("mdi-account")]),_:1})):n("",!0),l.IsUserSend?n("",!0):(o(),c(f,{key:1,class:"white--text"},{default:e(()=>[_("mdi-support")]),_:1}))]),_:2},1032,["color"]),l.IsUserSend?n("",!0):(o(),b("div",fe,[l.MessageType==="text"?(o(),c(h,{key:0},{default:e(()=>[t(u,{cols:"12",class:"pt-3 pa-0 text-right px-3"},{default:e(()=>[d("p",null,v(l.Content),1)]),_:2},1024),t(u,{cols:"12",class:"pb-2 pa-0 px-3"},{default:e(()=>[d("p",_e,v(l.time)+" "+v(l.date),1)]),_:2},1024)]),_:2},1024)):n("",!0),l.MessageType==="image"?(o(),c(h,{key:1,class:"bg-teal-lighten-5 rounded-lg"},{default:e(()=>[t(h,{justify:"center"},{default:e(()=>[t(R,{width:"500",modelValue:a.imgFullSize,"onUpdate:modelValue":g[1]||(g[1]=m=>a.imgFullSize=m),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:e(({isActive:m})=>[t(A,null,{default:e(()=>[t(E,{style:{"background-color":"black",height:"100vh"}},{default:e(()=>[t(I,{src:a.fullSizePreviewImg,width:"auto",cover:"",class:"rounded-lg"},null,8,["src"]),t(T,{icon:"mdi-close",position:"absolute",style:{top:"10px"},color:"white",size:"x-large",onClick:i=>m.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),d("div",null,[t(I,{src:l.image,"max-width":400,width:200,onClick:m=>a.imgFullSizePreview(l.image),cover:""},null,8,["src","onClick"]),t(u,{cols:"12",class:"px-3 pa-0 d-flex justify-space-between align-center align-self-end text-subtitle"},{default:e(()=>[d("div",null,[l.loading?(o(),c(f,{key:0,color:"grey-darken-1"},{default:e(()=>[_("mdi-check")]),_:1})):l.error?(o(),c(f,{key:1,color:"red"},{default:e(()=>[_("mdi-alert-circle")]),_:1})):!l.loading&&!l.error?(o(),c(f,{key:2,color:l.Seen?"blue-accent-3":"grey-darken-1"},{default:e(()=>[_("mdi-check-all")]),_:2},1032,["color"])):n("",!0)]),d("div",null,[d("p",he,v(l.date)+" "+v(l.time),1)])]),_:2},1024)])]),_:2},1024)):n("",!0)]))],2))),128))]),_:1}),a.error||a.loading?(o(),c(k,{key:0,class:"mb-8 mx-auto",loading:a.loading,error:a.error,postData:!1,onReload:a.reloadHandler},null,8,["loading","error","onReload"])):n("",!0)]),_:1}),a.chatImg.length>0?(o(),c(u,{key:0,class:"bg-grey-lighten-4 pa-2 type-box mx-auto",lg:"6",xl:"6",md:"8",cols:"12"},{default:e(()=>[t(T,{icon:"mdi-close",position:"absolute",onClick:a.closePreview},null,8,["onClick"]),t(u,{cols:"12",class:"rounded-lg"},{default:e(()=>[a.imgInvalid?(o(),b("p",ve," عکس باید کمتر از ۱ مگابایت باشد ")):n("",!0),t(I,{src:a.imgSrc,"max-width":400,width:200,class:"mx-auto"},{placeholder:e(()=>[d("div",ye,[t(le,{color:"grey-lighten-4",indeterminate:""})])]),_:1},8,["src"])]),_:1})]),_:1})):n("",!0),t(j,{class:"align-center py-2 msg-field"},{default:e(()=>[t(h,{class:"bg-white align-center",style:{height:"4rem"},"no-gutters":""},{default:e(()=>[t(u,{lg:"6",xl:"6",md:"8",cols:"12",class:"mx-auto pa-2"},{default:e(()=>[t(h,{"no-gutters":""},{default:e(()=>[t(u,{cols:"10"},{default:e(()=>[t(ie,{modelValue:a.msg,"onUpdate:modelValue":g[2]||(g[2]=l=>a.msg=l),placeholder:"پیام خود را بنویسید...",onKeypress:te(a.send,["enter"]),"hide-details":!0,color:"teal-accent-4",class:"text",focused:!1},null,8,["modelValue","onKeypress"])]),_:1}),t(u,{cols:"1",class:"pa-0 d-flex"},{default:e(()=>[t(oe,{accept:"image/png, image/jpeg,image/heic","prepend-icon":"mdi-camera","hide-details":!0,class:"image-input text-teal-accent-4 d-flex justify-end",rules:a.rules,modelValue:a.chatImg,"onUpdate:modelValue":g[3]||(g[3]=l=>a.chatImg=l)},null,8,["rules","modelValue"])]),_:1}),t(u,{cols:"1",class:"pa-0 d-flex align-center justify-start ml-lg-n4 ml-xl-n4 ml-md-n4"},{default:e(()=>[t(T,{icon:"",size:"large",onClick:a.send},{default:e(()=>[t(f,{color:"teal-accent-4"},{default:e(()=>[_("mdi-send")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["onBaseRouteBackHandler"])]),_:1})])}const ke=L(ue,[["render",xe]]),be={};function we(w,g,F,a,D,z){const k=ke;return o(),c(k)}const ll=L(be,[["render",we]]);export{ll as default};
