import{_ as G}from"./ErrorAlert.e56a56d9.js";import{_ as S,h as M,o as h,c as V,w as v,d as I,t as R,x as U,r as c,j as F,i as q,k as b,y as J,z as X,A as Y,m as P,B as Q,C as Z,F as H,n as ee,u as te,a as f,D as ne,V as B,e as $,l as K,s as ae,b as oe,E as le}from"./entry.26e0f55e.js";import{V as se}from"./VSnackbar.1da83577.js";import{u as ue,a as re}from"./useMyFetch.c7da1f4b.js";import{u as x}from"./cookie.8aa2c3a6.js";import{u as ie}from"./auth.d560fba5.js";import{V as de}from"./VForm.82fb9e0d.js";import{V as ce}from"./VChip.342a6faf.js";import"./VOverlay.1a61fd31.js";import"./easing.9f15041e.js";import"./lazy.54b8b11e.js";import"./index.7aba734a.js";import"./forwardRefs.e2994a01.js";import"./index.4548580c.js";import"./VAvatar.c6243a7c.js";import"./VImg.e043ba4f.js";const pe={props:{text:{type:String,required:!0},alertActive:{type:Boolean,required:!0}},setup(e,{emit:n}){return{alertActive:M({get(){return e.alertActive},set(t){n("update:alertActive",t)}})}}},me={class:"text text-center"};function fe(e,n,o,t,p,C){return h(),V(se,{timeout:2e3,color:"teal-accent-4",rounded:"pill",location:"top",modelValue:t.alertActive,"onUpdate:modelValue":n[0]||(n[0]=s=>t.alertActive=s)},{activator:v(({props:s})=>[]),default:v(()=>[I("p",me,R(o.text),1)]),_:1},8,["modelValue"])}const ve=S(pe,[["render",fe]]),he=U({name:"SingleOtpInput",props:{inputType:{type:String,validator:e=>["number","tel","letter-numeric","password"].includes(e),default:"tel"},inputmode:{type:String,default:"numeric"},value:{type:[String,Number]},separator:{type:String},focus:{type:Boolean},inputClasses:{type:[String,Array]},conditionalClass:{type:String},shouldAutoFocus:{type:Boolean},isLastChild:{type:Boolean},placeholder:{type:String},isDisabled:{type:Boolean}},emits:["on-change","on-keydown","on-paste","on-focus","on-blur"],setup(e,{emit:n}){const o=c(e.value||""),t=c(null),p=()=>(o.value=o.value.toString(),o.value.length>1&&(o.value=o.value.slice(0,1)),n("on-change",o.value)),C=l=>l>=65&&l<=90,s=l=>l>=48&&l<=57||l>=96&&l<=105,i=l=>{e.isDisabled&&l.preventDefault();const d=l||window.event,_=d.which?d.which:d.keyCode;s(_)||e.inputType==="letter-numeric"&&C(_)||[8,9,13,37,39,46,86].includes(_)?n("on-keydown",l):d.preventDefault()},u=l=>n("on-paste",l),y=()=>(t.value.select(),n("on-focus")),g=()=>n("on-blur");return F(()=>e.value,(l,d)=>{l!==d&&(o.value=l)}),F(()=>e.focus,(l,d)=>{d!==l&&t.value&&e.focus&&(t.value.focus(),t.value.select())}),q(()=>{t.value&&e.focus&&e.shouldAutoFocus&&(t.value.focus(),t.value.select())}),{handleOnChange:p,handleOnKeyDown:i,handleOnPaste:u,handleOnFocus:y,handleOnBlur:g,input:t,model:o,inputTypeValue:e.inputType==="letter-numeric"?"text":e.inputType}}});const ye={style:{display:"flex","align-items":"center"}},ge=["type","inputmode","placeholder","disabled"],Ce={key:0},Oe=["innerHTML"];function be(e,n,o,t,p,C){return h(),b("div",ye,[J(I("input",{"data-test":"single-input",type:e.inputTypeValue,inputmode:e.inputmode,placeholder:e.placeholder,disabled:e.isDisabled,ref:"input",min:"0",max:"9",maxlength:"1",pattern:"[0-9]","onUpdate:modelValue":n[0]||(n[0]=s=>e.model=s),class:Y(["otp-input",[e.inputClasses,e.conditionalClass,{"is-complete":e.model}]]),onInput:n[1]||(n[1]=(...s)=>e.handleOnChange&&e.handleOnChange(...s)),onKeydown:n[2]||(n[2]=(...s)=>e.handleOnKeyDown&&e.handleOnKeyDown(...s)),onPaste:n[3]||(n[3]=(...s)=>e.handleOnPaste&&e.handleOnPaste(...s)),onFocus:n[4]||(n[4]=(...s)=>e.handleOnFocus&&e.handleOnFocus(...s)),onBlur:n[5]||(n[5]=(...s)=>e.handleOnBlur&&e.handleOnBlur(...s))},null,42,ge),[[X,e.model]]),!e.isLastChild&&e.separator?(h(),b("span",Ce,[I("span",{innerHTML:e.separator},null,8,Oe)])):P("",!0)])}const _e=S(he,[["render",be],["__scopeId","data-v-4defdce7"]]),Ae=8,Ie=37,ke=39,Te=46,De=U({name:"Vue3OtpInput",components:{SingleOtpInput:_e},props:{value:{type:String,default:"",required:!0},numInputs:{default:5},separator:{type:String,default:""},inputClasses:{type:[String,Array]},conditionalClass:{type:Array,default:[]},inputType:{type:String,validator:e=>["number","tel","letter-numeric","password"].includes(e)},inputmode:{type:String,validator:e=>["numeric","text","tel","none"].includes(e),default:"numeric"},shouldAutoFocus:{type:Boolean,default:!1},placeholder:{type:Array,default:[]},isDisabled:{type:Boolean,default:!1}},setup(e,{emit:n}){const o=c(0),t=c([]),p=c([]);F(()=>e.value,r=>{const m=Q(r).split("");t.value=m},{immediate:!0});const C=r=>{o.value=r},s=()=>{o.value=-1},i=()=>t.value.join("").length===e.numInputs?(n("update:value",t.value.join("")),n("on-complete",t.value.join(""))):"Wait until the user enters the required number of characters",u=r=>{o.value=Math.max(Math.min(e.numInputs-1,r),0)},y=()=>{u(o.value+1)},g=()=>{u(o.value-1)},l=r=>{p.value=Object.assign([],t.value),t.value[o.value]=r,p.value.join("")!==t.value.join("")&&(n("update:value",t.value.join("")),n("on-change",t.value.join("")),i())};return{activeInput:o,otp:t,oldOtp:p,clearInput:()=>{t.value.length>0&&(n("update:value",""),n("on-change","")),t.value=[],o.value=0},handleOnPaste:r=>{r.preventDefault();const m=r.clipboardData.getData("text/plain").slice(0,e.numInputs-o.value).split("");if(e.inputType==="number"&&!m.join("").match(/^\d+$/)||e.inputType==="letter-numeric"&&!m.join("").match(/^\w+$/))return"Invalid pasted data";const k=t.value.slice(0,o.value).concat(m);return k.slice(0,e.numInputs).forEach(function(w,A){t.value[A]=w}),u(k.slice(0,e.numInputs).length),i()},handleOnKeyDown:r=>{switch(r.keyCode){case Ae:r.preventDefault(),l(""),g();break;case Te:r.preventDefault(),l("");break;case Ie:r.preventDefault(),g();break;case ke:r.preventDefault(),y();break}},handleOnBlur:s,changeCodeAtFocus:l,focusInput:u,focusNextInput:y,focusPrevInput:g,handleOnFocus:C,checkFilledAllInputs:i,handleOnChange:r=>{l(r),y()},fillInput:r=>{const m=r.split("");m.length===e.numInputs&&(t.value=m,n("update:value",t.value.join("")),n("on-complete",t.value.join("")))}}}}),Se={style:{display:"flex","justify-content":"center"},class:"otp-input-container"},we={key:0,autocomplete:"off",name:"hidden",type:"text",style:{display:"none"}};function Be(e,n,o,t,p,C){const s=Z("SingleOtpInput");return h(),b("div",Se,[e.inputType==="password"?(h(),b("input",we)):P("",!0),(h(!0),b(H,null,ee(e.numInputs,(i,u)=>(h(),V(s,{key:u,focus:e.activeInput===u,value:e.otp[u],separator:e.separator,"input-type":e.inputType,inputmode:e.inputmode,"input-classes":e.inputClasses,conditionalClass:e.conditionalClass[u],"is-last-child":u===e.numInputs-1,"should-auto-focus":e.shouldAutoFocus,placeholder:e.placeholder[u],"is-disabled":e.isDisabled,onOnChange:e.handleOnChange,onOnKeydown:e.handleOnKeyDown,onOnPaste:e.handleOnPaste,onOnFocus:y=>e.handleOnFocus(u),onOnBlur:e.handleOnBlur},null,8,["focus","value","separator","input-type","inputmode","input-classes","conditionalClass","is-last-child","should-auto-focus","placeholder","is-disabled","onOnChange","onOnKeydown","onOnPaste","onOnFocus","onOnBlur"]))),128))])}const W=S(De,[["render",Be]]);const Fe={components:{OTPParent:W},setup(){const e=te(),n=ie(),o=2*365*24*60*60,t=new Date().getTime()+o*1e3,p=x("userToken",{maxAge:t}),C=x("userId",{maxAge:t}),s=le(),i=c(""),u=c(!1),y=c(!1),g=c(!1),l=c(!1),d=c("00:59"),_=M(()=>n.PhoneNumberGet),O=c(!1),j=a=>{O.value=a},E=a=>{l.value=a},r=async()=>{try{const a=await ue(`/send-sms?phoneNumber=${_.value}`,u,O,"get");O.value||(l.value=!0,y.value=!1,g.value=!g.value,d.value="00:59",A(),i.value="")}catch(a){O.value=!0,console.error("Error fetching data:",a)}},m=async()=>{if(u.value=!0,i.value.length>=4){let a;try{a=await re(s.public.baseURL+"/check-sms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:_.value,code:i.value})},"$SnAqiyMuXP")}catch(T){console.log(T),O.value=!0}a.status.value==="success"?(u.value=!1,e.push("/home"),n.accessToken=a.data.value.Token,p.value=a.data.value.Token,n.userId=a.data.value.Id,C.value=a.data.value.Id):a.error.value&&(u.value=!1,a.error.value.data?y.value=!0:O.value=!0)}},L=()=>{e.push("/")},k=a=>{i.value=a,m()},w=a=>{i.value=a};function A(){let T=d.value.split(/[:]+/),D=T[0],N=z(T[1]-1);if(N==59&&(D=D-1),D<0){g.value=!0;return}d.value=D+":"+N,setTimeout(A,1e3)}function z(a){return a<10&&a>=0&&(a="0"+a),a<0&&(a="59"),a}return q(()=>{A()}),{otp:i,confirmCode:m,timer:d,resendCode:g,resendCodeHandler:r,changeNumber:L,codeLoading:u,codeError:y,error:O,updateErrorAlert:j,updateInfoAlert:E,resendCodeSuccessful:l,submit:k,changes:w}}},Ve=I("p",{class:"text-title mb-3"},"لطفا کد ارسال شده را وارد کنید",-1),Pe=I("p",{class:"text"},"تغییر شماره موبایل",-1),je={key:0,class:"text-error text-body-2 mb-4"},Ee={key:2,class:"mt-4 text-title"};function Le(e,n,o,t,p,C){const s=G,i=ve,u=W;return h(),b(H,null,[f(s,{errorActive:t.error,"onUpdate:errorActive":t.updateErrorAlert},null,8,["errorActive","onUpdate:errorActive"]),f(i,{alertActive:t.resendCodeSuccessful,"onUpdate:alertActive":t.updateInfoAlert,text:"کد مجدد ارسال شد"},null,8,["alertActive","onUpdate:alertActive"]),f(de,{onSubmit:ne(t.confirmCode,["prevent"]),class:"confirm"},{default:v(()=>[f(B,{class:"text-center text-grey-darken-2 mt-5"},{default:v(()=>[Ve,f(u,{numInputs:4,value:t.otp,inputType:"number",inputmode:"numeric",onOnComplete:t.submit,"onUpdate:value":t.changes,shouldAutoFocus:!0,isDisabled:t.codeLoading,inputClasses:[t.codeError?"code-error":""]},null,8,["value","onOnComplete","onUpdate:value","isDisabled","inputClasses"]),f(B,{cols:"8",class:"d-flex pa-0 mx-auto mt-7 justify-center"},{default:v(()=>[f(ce,{color:"teal-accent-4",onClick:t.changeNumber},{default:v(()=>[Pe]),_:1},8,["onClick"])]),_:1}),t.codeError?(h(),b("p",je," کد وارد شده صحیح نیست دوباره تلاش کنید ")):P("",!0),t.resendCode?(h(),V(K,{key:1,class:"text-teal-accent-4 mt-4 text-title",size:"large",disabled:t.codeLoading,onClick:t.resendCodeHandler},{default:v(()=>[$("ارسال مجدد کد")]),_:1},8,["disabled","onClick"])):(h(),b("p",Ee,"ارسال مجدد کد در : "+R(t.timer),1))]),_:1}),f(ae,{class:"submit-btn mx-auto"},{default:v(()=>[f(oe,{class:"d-flex justify-center"},{default:v(()=>[f(B,{xl:"7",lg:"7",md:"8",sm:"10",xs:"12",cols:"12"},{default:v(()=>[f(K,{disabled:t.otp.length<4||t.codeLoading,color:"teal-accent-4",block:"",loading:t.codeLoading,type:"submit"},{default:v(()=>[$("تایید")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])],64)}const Ze=S(Fe,[["render",Le]]);export{Ze as default};
