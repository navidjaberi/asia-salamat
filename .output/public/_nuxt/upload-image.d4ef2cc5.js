import{_ as M}from"./LoadingAndError.71246b88.js";import{_ as L}from"./PageBaseLayout.c72097e2.js";import{_ as S,r as i,u as C,i as R,o as d,k as N,a as m,w as g,b as H,F as U,n as z,c as F,V as T,d as $,t as O,f as j,m as J}from"./entry.26e0f55e.js";import{u as E}from"./useMyFetch.c7da1f4b.js";import{V as X,h as Y}from"./VFileInput.03cfb6c6.js";import{V as Z}from"./VDivider.8253b586.js";import{V as q}from"./VApp.dbfd8bb3.js";import"./VAlert.ba30a257.js";import"./createSimpleFunctional.17b0ee17.js";import"./VForm.82fb9e0d.js";import"./forwardRefs.e2994a01.js";import"./auth.d560fba5.js";import"./cookie.8aa2c3a6.js";import"./_commonjsHelpers.23102255.js";import"./VField.de963f4c.js";import"./index.4548580c.js";import"./index.7aba734a.js";import"./VInput.46c0eb00.js";import"./easing.9f15041e.js";import"./VChip.342a6faf.js";import"./VAvatar.c6243a7c.js";import"./VImg.e043ba4f.js";const G=[{title:":تصویر عکس پرسنلی ",id:"Picture",loading:null},{title:":تصویر صفحه اول شناسنامه ",id:"FirstPageImage"},{title:"تصویر صفحه توضیحات شناسنامه : (وضعیت تاهل) ",id:"DescriptionImage",loading:null},{title:"تصویر رضایت نامه همسر و یا سرپرست خانواده : (ویژه بانوان)",id:"AgreementImage",loading:null}],K={setup(){const f=i(G),u=C(),h=i(localStorage.getItem("nurseId")),e=i({}),c=i(!1),p=i(!1),l=i(!1),y=i([a=>!a||!a.length?"عکس را انتخاب کنید":!0]),s=async(a,o,t)=>{if(t.loading=!0,Array.isArray(o)&&o.length>0){const r=await w(o[0]);e.value={...e.value,[a]:[r]}}else e.value={...e.value,[a]:o};t.loading=!1},I=async()=>{const a=JSON.parse(localStorage.getItem("nurseImgNames"));for(let[o,t]of Object.entries(a))try{const r=await E(`/uploads/${t}`,c,p,"get"),n=new File([r],t,{type:r.type,lastModified:Date.now()});e.value[o]=[n]}catch(r){console.log(r),p.value=!0}},w=a=>new Promise(async o=>{const t=new FileReader;if(t.onload=r=>{const n=new Image;n.onload=()=>{const v=Math.min(1,1048576/(n.width*n.height*1.5)),D=Math.floor(n.width*v),B=Math.floor(n.height*v),_=document.createElement("canvas"),V=_.getContext("2d");_.width=D,_.height=B,V.drawImage(n,0,0,D,B),_.toBlob(A=>{const P=a.name.replace("HEIC","jpeg"),k=new File([A],P,{type:a.type,lastModified:Date.now()});o(k)},a.type,.8)},n.src=r.target.result},a.type==="image/heic")try{const r=await Y({blob:a});t.readAsDataURL(r)}catch(r){console.error("Error converting image:",r)}else t.readAsDataURL(a)}),b=async a=>{if(window.scrollTo({top:0,behavior:"smooth"}),a){localStorage.removeItem("nurseImgNames");const o=new FormData;o.append("NurseId",h.value),o.append("Picture",e.value.Picture[0]),o.append("FirstPageImage",e.value.FirstPageImage[0]),o.append("DescriptionImage",e.value.DescriptionImage[0]),e.value.AgreementImage&&o.append("AgreementImage",e.value.AgreementImage[0]);try{const t=await E("/Nurse/uploads",c,l,"put","",o);localStorage.setItem("nurseImgNames",JSON.stringify({Picture:t.NurseImages.Picture,FirstPageImage:t.NurseImages.FirstPageImage,DescriptionImage:t.NurseImages.DescriptionImage,AgreementImage:t.NurseImages.AgreementImage})),localStorage.setItem("pdfNum",t.formCode),u.push("/employment/relatives-info")}catch(t){t=!0,console.error("Error fetching data:",t)}}},x=()=>{u.push("/employment/collaboration-terms")};return R(()=>{localStorage.getItem("nurseImgNames")&&I()}),{inputFields:f,rules:y,submit:b,routBackHandler:x,updateFormData:s,loading:c,postError:l,formData:e}}},Q={class:"text-right text-title"};function W(f,u,h,e,c,p){const l=M,y=L;return d(),N("div",null,[m(q,null,{default:g(()=>[m(y,{title:"آپلود عکس",formClass:"upload-image",onBaseRouteBackHandler:e.routBackHandler,onBaseSubmit:e.submit},{default:g(()=>[m(l,{loading:e.loading,error:e.postError,class:"mb-3",postData:!0},null,8,["loading","error"]),m(H,{class:"mb-7"},{default:g(()=>[(d(!0),N(U,null,z(e.inputFields,(s,I)=>(d(),F(T,{xxl:"5",xl:"6",lg:"7",md:"8",cols:"12",class:"pa-0 mx-auto",key:"i"},{default:g(()=>[$("p",Q,O(s.title),1),m(X,{accept:"image/png, image/jpeg,image/heic","show-size":"","prepend-icon":"none",color:"teal-accent-4",label:"انتخاب عکس",rules:I===3||s.loading===!0?[]:e.rules,loading:s.loading===!0,required:"","prepend-inner-icon":"mdi-camera","model-value":e.formData[s.id],"onUpdate:modelValue":w=>e.updateFormData(s.id,w,s)},{default:g(()=>[m(j,{"slot:prepend-inner":""})]),_:2},1032,["rules","loading","model-value","onUpdate:modelValue"]),I<3?(d(),F(Z,{key:0})):J("",!0)]),_:2},1024))),128))]),_:1})]),_:1},8,["onBaseRouteBackHandler","onBaseSubmit"])]),_:1})])}const ee=S(K,[["render",W]]),te={};function ae(f,u,h,e,c,p){const l=ee;return d(),F(l)}const Ee=S(te,[["render",ae]]);export{Ee as default};
